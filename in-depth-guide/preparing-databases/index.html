<!doctype html>
<html lang="pt-br">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Tutoriais do Zend Framework">  
    <link rel="shortcut icon" href="../../img/favicon.ico">

    <title>Preparando-se para Bancos de Dados Diferentes - Tutoriais do Zend Framework</title>

    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css"
        integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w="
        crossorigin="anonymous" />
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
        integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0="
        crossorigin="anonymous" />
    <link rel="stylesheet" href="../../css/styles-288837cc22.css">

    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-108409296-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-108409296-1');
    </script>
    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Alternar navegação</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <span class="navbar-brand">
                <a class="logo-link" href="https://framework.zend.com/" data-toggle="tooltip" data-placement="bottom" title="Ir para a página inicial do Zend Framework"><img src="../../img/zf-logo-mark.svg" height="28" alt="Zend Framework" /></a>
                <a href="../..">tutoriais</a>
            </span>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutoriais sobre MVC <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Começando com o Zend Framework</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../getting-started/overview/">Visão Geral</a>
</li>

        
            
<li >
    <a href="../../getting-started/skeleton-application/">A Aplicação Esqueleto</a>
</li>

        
            
<li >
    <a href="../../getting-started/modules/">Módulos</a>
</li>

        
            
<li >
    <a href="../../getting-started/routing-and-controllers/">Roteamento e Controllers</a>
</li>

        
            
<li >
    <a href="../../getting-started/database-and-models/">Banco de Dados e Models</a>
</li>

        
            
<li >
    <a href="../../getting-started/forms-and-actions/">Formulários e Actions</a>
</li>

        
            
<li >
    <a href="../../getting-started/conclusion/">Conclusão</a>
</li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../../unit-testing/">Realizando Testes Unitários em uma Aplicação zend-mvc</a>
</li>

                        
                            
<li >
    <a href="../../navigation/">Adicionando zend-navigation ao Módulo Album</a>
</li>

                        
                            
<li >
    <a href="../../pagination/">Adicionando zend-paginator ao Módulo Album</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Tutorial Aprofundado</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../first-module/">Apresentando o Módulo Blog</a>
</li>

        
            
<li >
    <a href="../models-and-servicemanager/">Models e o ServiceManager</a>
</li>

        
            
<li class="active">
    <a href="./">Preparando-se para Bancos de Dados Diferentes</a>
</li>

        
            
<li >
    <a href="../zend-db-sql-zend-hydrator/">Abstração de SQL e Hidratação de Objetos</a>
</li>

        
            
<li >
    <a href="../understanding-routing/">Entendendo o Router</a>
</li>

        
            
<li >
    <a href="../zend-form-zend-form-fieldset/">Usando Forms e Fieldsets</a>
</li>

        
            
<li >
    <a href="../data-binding/">Editando e Deletando Dados</a>
</li>

        
            
<li >
    <a href="../review/">Revisando o Módulo Blog</a>
</li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../../advanced-config/">Configuração Avançada</a>
</li>

                        
                            
<li >
    <a href="../../i18n/">Internacionalização</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutoriais de Componentes <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../db-adapter/">Configurando um Adapter de Bancos de Dados</a>
</li>

                        
                            
<li >
    <a href="../../event-manager/">Usando o EventManager</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Migração <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Para a Versão 3</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../migration/to-v3/overview/">Visão Geral</a>
</li>

        
            
<li >
    <a href="../../migration/to-v3/components/">Componentes</a>
</li>

        
            
<li >
    <a href="../../migration/to-v3/application/">Aplicações</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" class="component-toggle" data-toggle="tooltip" data-placement="bottom" title="Exibir lista de componentes">
                        <i class="fa fa-book"></i> Componentes
                    </a>
                </li>

                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Pesquisar
                    </a>
                </li>
                
                    <li>
                        <a href="https://github.com/arcristo/zend-tutorials-pt-br/">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

    
        <div id="page-top" class="container docs">
            
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#preparing-for-different-databases">Preparing for Different Databases</a></li>
        
            <li><a href="#what-is-database-abstraction">What is database abstraction?</a></li>
        
            <li><a href="#adding-command-abstraction">Adding command abstraction</a></li>
        
            <li><a href="#conclusion">Conclusion</a></li>
        
    
    </ul>

    
    <ul class="pager hidden-print">
      <li class="previous">
        <a rel="prev" href="../models-and-servicemanager/"><i class="fa fa-arrow-left"></i> Anterior</a>
      </li>
      <li class="next">
        <a rel="next" href="../zend-db-sql-zend-hydrator/">Próxima <i class="fa fa-arrow-right"></i></a>
      </li>
    </ul>
    
</div></div>
            <div class="col-md-9" role="main">

<ol class="breadcrumb" role="navigation" aria-label="breadcrumbs navigation">
  <li><a href="../..">tutoriais</a></li>
  
    
      
        <li>Tutoriais sobre MVC</li>
      
    
      
        <li>Tutorial Aprofundado</li>
      
    
  
  <li class="active">Preparando-se para Bancos de Dados Diferentes</li>
</ol>

<h1 id="preparing-for-different-databases">Preparing for Different Databases</h1>
<p>In the previous chapter, we created a <code>PostRepository</code> that returns some data
from blog posts. While the implementation was adequate for learning purposes, it
is quite impractical for real world applications; no one would want to modify
the source files each time a new post is added! Fortunately, we an always turn
to databases for the actual storage of posts; all we need to learn is how to
interact with databases within our application.</p>
<p>There's one small catch: there are many database backend systems, including
relational databases, documentent databases, key/value stores, and graph
databases. You may be inclined to code directly to the solution that fits your
application's immediate needs, but it is a better practice to create another
layer in front of the actual database access that abstracts the database
interaction. The <em>repository</em> approach we used in the previous chapter is one
such approach, primarily geared towards <em>queries</em>. In this section, we'll expand
on it to add <em>command</em> capabilities for creating, updating, and deleting
records.</p>
<h2 id="what-is-database-abstraction">What is database abstraction?</h2>
<p>"Database abstraction" is the act of providing a common interface for all
database interactions. Consider a SQL and a NoSQL database; both have methods
for CRUD (Create, Read, Update, Delete) operations. For example, to query the
database against a given row in MySQL you might use</p>
<pre class="codehilite"><code class="language-php">$results = mysqli_query('SELECT foo FROM bar')`;</code></pre>

<p>However, for MongoDB,  for example you'd use something like:</p>
<pre class="codehilite"><code class="language-php">$results = $mongoDbClient-&gt;app-&gt;bar-&gt;find([], ['foo' =&gt; 1, '_id' =&gt; 0])`;</code></pre>

<p>Both engines would give you the same result, but the execution is different.</p>
<p>So if we start using a SQL database and write those codes directly into our
<code>PostRepository</code> and a year later we decide to switch to a NoSQL database, the
existing implementation is useless to us. And in a few years later, when a new
persistence engine pops up, we have to start over yet again.</p>
<p>If we hadn't created an interface first, we'd also likely need to change our
consuming code! </p>
<p>On top of that, we may find that we want to use some sort of distributed caching
layer for <em>read</em> operations (fetching items), while <em>write</em> operations will be
written to a relational database. Most likely, we don't want our controllers to
need to worry about those implementation details, but we will want to ensure
that we account for this in our architecture.</p>
<p>At the code level, the interface is our abstraction layer for dealing with
differences in implementations. However, currently, we only deal with queries.
Let's expand on that.</p>
<h2 id="adding-command-abstraction">Adding command abstraction</h2>
<p>Let's first think a bit about what possible database interactions we can think
of. We need to be able to:</p>
<ul>
<li>find a single blog post</li>
<li>find all blog posts</li>
<li>insert new blog post</li>
<li>update existing blog posts</li>
<li>delete existing blog posts</li>
</ul>
<p>At this time, our <code>PostRepositoryInterface</code> deals with the first two.
Considering this is the layer that is most likely to use different backend
implementations, we probably want to keep it separate from the operations that
cause changes.</p>
<p>Let's create a new interface, <code>Blog\Model\PostCommandInterface</code>, in
<code>module/Blog/src/Model/PostCommandInterface.php</code>, and have it read as follows:</p>
<pre class="codehilite"><code class="language-php">namespace Blog\Model;

interface PostCommandInterface
{
    /**
     * Persist a new post in the system.
     *
     * @param Post $post The post to insert; may or may not have an identifier.
     * @return Post The inserted post, with identifier.
     */
    public function insertPost(Post $post);

    /**
     * Update an existing post in the system.
     *
     * @param Post $post The post to update; must have an identifier.
     * @return Post The updated post.
     */
    public function updatePost(Post $post);

    /**
     * Delete a post from the system.
     *
     * @param Post $post The post to delete.
     * @return bool
     */
    public function deletePost(Post $post);
}</code></pre>

<p>This new interface defines methods for each <em>command</em> within our model. Each
expects a <code>Post</code> instance, and it is up to the implementation to determine how
to use that instance to issue the command. In the case of an insert operation,
our <code>Post</code> does not require an identifier (which is why the value is nullable in
the constructor), but will return a new instance that is guaranteed to have one.
Similarly, the update operation will return the updated post (which may be the
same instance!), and a delete operation will indicate if the operation was
successful.</p>
<h2 id="conclusion">Conclusion</h2>
<p>We're not quite ready to use the new interface; we're using it to set the stage
for the next few chapters, where we look at using zend-db to implement our
persistence, and later creating new controllers to handle blog post
manipulation.</p>

<hr />


<nav>
  <ul class="pager hidden-print">
    <li class="previous">
      <a rel="prev" href="../models-and-servicemanager/"><i class="fa fa-arrow-left"></i> Anterior</a>
    </li>
    <li class="next">
      <a rel="next" href="../zend-db-sql-zend-hydrator/">Próxima <i class="fa fa-arrow-right"></i></a>
    </li>
  </ul>
</nav>
</div>
            
        </div>
    

    <div id="footerwrap">
    <div class="container">
        <div class="row site-map">
            <div class="col-lg-3">
              <p>
                <strong>Zend Framework</strong><br />
                <a href="https://framework.zend.com/">framework.zend.com</a><br />
                <a href="https://docs.zendframework.com">docs.zendframework.com</a><br />
                <a href="https://packages.zendframework.com">packages.zendframework.com</a><br />
                <a href="https://apigility.org">apigility.org</a><br />
              </p>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12 centered">
                <a class="back-to-top" href="#page-top"><i class="fa fa-chevron-circle-up fa-4" aria-hidden="true"></i></a>
            </div>
        </div>

        <div class="spacing"></div>

        <div class="row">
            <div class="col-lg-8">
                <h4>Copyright</h4>
                <div class="hline-w"></div>

                <p>&copy; 2006-2017 by <a href="https://www.zend.com/">Zend</a>, a <a href="https://www.roguewave.com/">Rogue Wave Company</a>.</p>
            </div>

            <div class="col-lg-4">
                <h4>Contacts</h4>
                <div class="hline-w"></div>
                <p>
                    <a href="https://discourse.zendframework.com" class="btn-social btn-outline" alt="Forum" title="Forum"><i class="fa fa-comments"></i></a>
                    <a href="https://zendframework-slack.herokuapp.com" class="btn-social btn-outline" alt="Slack" title="Slack"><i class="fa fa-slack"></i></a>
                    <a href="https://github.com/zendframework" class="btn-social btn-outline" alt="Github" title="Github"><i class="fa fa-github"></i></a>
                    <a href="https://twitter.com/zfdevteam" class="btn-social btn-outline" alt="Twitter" title="Twitter"><i class="fa fa-twitter"></i></a>
                </p>
            </div>
        </div>
    </div>
</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"
        integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8="
        crossorigin="anonymous"></script>

    <script>var base_url = '../..';</script>
    <script src="../../js/scripts-60a9690001.js"></script>
    <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../search/require.js"></script>
        <script src="../../search/search.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Modal de Pesquisa" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Fechar</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Pesquisar</h4>
                </div>
                <div class="modal-body">
                    <p>
                        A partir daqui você pode pesquisar esses documentos. Digite seus termos de pesquisa abaixo.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Pesquisar..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    <div class="zf-components">
  <div class="zf-components-grid">
    <div class="zf-logo">
      <a href="https://framework.zend.com" data-toggle="tooltip" data-placement="bottom" title="Ir para a página inicial do Zend Framework"><img src="../../img/zf-logo-mark.svg" alt="Zend Framework" width="250" /></a>
    </div>

    <div class="component-list"></div>

    <p class="zf-components-rollup"><a href="#">Ocultar lista</a></p>
  </div>
</div>

</body>

</html>
